<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:j="http://java.sun.com/jsp/jstl/core"
	>
	
	
	
	<f:metadata>
		<f:viewAction action="#{utilJsf.messageFromRequestAttribute()}" />
	</f:metadata>
	<h:head>
		<h:outputStylesheet name="popup.css" library="css" />

	</h:head>
	<div class="overlay"></div>

	<h:panelGroup id="popup_container">
		<!--Bouton fermer -->
		<div id="popup_header">

			<!--Bouton fermer -->
			<!--Titre du Livre -->

			<h2 id="titlePop">
				<h:outputText value="${modelPopup.selectedBook.nom}"></h:outputText>
			</h2>
			<button type="button" class="btn-close close" aria-label="Close"></button>
		</div>
		<!--Titre du Livre -->

		<div id="midPop">
			<!--Image du livre -->
			<h:graphicImage id="imgPop" url="${modelPopup.selectedBook.image}">
			</h:graphicImage>


			<!--Image du livre -->


			<!-- bloc information livre;auteur,description lien....-->
			<div id="informations">

				<input id="isbn" style="display: none;" name="isbn"></input>
				<ul>
					<li id="authors"><strong>Authors: </strong> <span><h:outputText
								value="${modelPopup.selectedBook.author}" /></span></li>
					<li id="description"><strong>Description: </strong> <span><h:outputText
								value="${modelPopup.selectedBook.resume}" /></span></li>
					<li id="links"></li>
					<li id="links2"></li>
					<h:form rendered="${compteActif.loggedIn}">

						<h:selectBooleanCheckbox id="favorite" class='favorite-heart'
							style="visibility:hidden">

						</h:selectBooleanCheckbox>
						<h:outputLabel for='favorite'>&#9825;</h:outputLabel>
					</h:form>
				</ul>
				<div id="favorite-alerts">
					<div class="alert alert-light" id="success-favorites-add">
						Book have been <strong>added</strong> to your favorites.
					</div>
					<div class="alert alert-light" id="success-favorites-remove">
						Book have been <strong>removed</strong> from your favorites.
					</div>
					<script>
						$("#success-favorites-add").hide();
						$("#success-favorites-remove").hide();
						document.getElementsByClassName('close')[0].addEventListener('click', (e) => {
							e.stopPropagation();
								closePopup();
							})
							//close popup on click anywhere out of popup
							document.getElementsByClassName('overlay')[0].addEventListener('click', (e) => {
								e.stopPropagation();
								closePopup();
							})
							popup.show();
													
					</script>
				</div>
			</div>

			<br />
			<!--Image du livre -->
			<div id="commentaryArea">

<ui:repeat 
			value="#{modelPopup.commentaires}" var="comm" >
			
			<div class='commentaire'>
					<div class='commentaireHeader'>
						<div class='avatarandname'>
							<img
								src='https://pbs.twimg.com/profile_images/911523367492161536/XDOQPjqf_400x400.jpg'
								width='50px' height='50px' id='avatar' />
							<div id='user-time'>
								<strong class='username'><h:outputText
										value="${comm.userPseudo}" /></strong>
								<time class='date'>${comm.cmtDate}</time>
							</div>
						</div>

					</div>
					<div class="reply-rating">
<input type="text" style="visibility:hidden;width:0;height:0;" value="${comm.cmtNote}"/>

					</div>
					<div class='commentaireContent'>
						<p>${comm.cmtDescription}</p>
					</div>
					</div>
</ui:repeat>
				
					<!-- affichage des commentaires Sql -->

<script>


		
		
	
</script>
				</div>

			</div>

			<h:panelGroup rendered="${compteActif.loggedIn}" class="container">
				<h:form id="replyForm">
					<div class="form-group">

						<label for="comment">Add a comment:</label>
						<h:inputTextarea value="#{modelPopup.reply}" name="commentaire"
							class="form-control" id="comment" rows="3" style="resize: none;">
						</h:inputTextarea>
					</div>
					<div class="rating">
						<input type="radio" name="rating" value="5" id="5" /><label
							for="5">☆</label> <input type="radio" name="rating" value="4"
							id="4" /><label for="4">☆</label> <input type="radio"
							name="rating" value="3" id="3" /><label for="3">☆</label> <input
							type="radio" name="rating" value="2" id="2" /><label for="2">☆</label>
						<input type="radio" name="rating" value="1" id="1" /><label
							for="1">☆</label>
					</div>
					<div>
						<h:commandButton name="commenter" class="btn btn-dark"
							action="#{modelPopup.sendReply()}" value="Submit a comment">
						</h:commandButton>
						<h:inputText value="#{modelPopup.note}" class="livre_note"
							style="visibility:hidden" />
						<script>
			document.getElementsByName("rating").forEach(r=>r.addEventListener("click",e=>{document.getElementsByClassName("livre_note")[0].value=e.target.value}))
			</script>


					</div>

					<input id="valuePage" style="display: none" name="valuePage"></input>
				</h:form>


			</h:panelGroup>
			<h:panelGroup rendered="${!compteActif.loggedIn}">
				<p style='text-align: center; font-size: 20px; margin-top: 30px;'>
					<h:link outcome="login" value="Log in"></h:link>
					to reply
				</p>
			</h:panelGroup>
	</h:panelGroup>
	<h:outputScript name="popup.js" library="js" />

</ui:composition>

